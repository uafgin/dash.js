{"version":3,"sources":["../../../../src/dash/SegmentBaseLoader.js"],"names":["SegmentBaseLoader","context","instance","logger","errHandler","boxParser","requestModifier","dashMetrics","settings","mediaPlayerModel","urlLoader","events","eventBus","errors","constants","dashConstants","urlUtils","baseURLController","setup","initialize","create","useFetch","get","streaming","lowLatencyEnabled","setConfig","config","debug","getLogger","checkConfig","hasOwnProperty","Error","loadInitialization","streamId","mediaType","representation","loadingInfo","initRange","baseUrl","resolve","path","info","init","url","undefined","range","start","end","searching","bytesLoaded","bytesToLoad","request","getFragmentRequest","onload","response","findInitRange","trigger","INITIALIZATION_LOADED","onerror","load","success","error","loadSegments","callback","parts","toString","split","parseFloat","onLoaded","isoFile","sidx","hasRange","extraBytes","loadedLength","byteLength","parse","getBox","isComplete","offset","size","lastBox","getLastBox","ref","references","loadMultiSidx","segments","length","reference_type","j","len","ss","se","r","segs","count","tmpCallback","result","concat","sort","a","b","startTime","referenced_size","id","getSegmentsForSidx","reset","abort","refs","timescale","time","earliest_presentation_time","first_offset","segment","duration","i","subsegment_duration","Segment","mediaRange","push","FragmentRequest","setInfo","SEGMENTS_LOADED","DashJSError","SEGMENT_BASE_LOADER_ERROR_CODE","SEGMENT_BASE_LOADER_ERROR_MESSAGE","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"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","file":"SegmentBaseLoader.js","sourcesContent":["/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\nimport Segment from './vo/Segment';\r\nimport DashJSError from '../streaming/vo/DashJSError';\r\nimport FactoryMaker from '../core/FactoryMaker';\r\nimport FragmentRequest from '../streaming/vo/FragmentRequest';\r\nimport URLLoader from '../streaming/net/URLLoader';\r\n\r\nfunction SegmentBaseLoader() {\r\n\r\n    const context = this.context;\r\n\r\n    let instance,\r\n        logger,\r\n        errHandler,\r\n        boxParser,\r\n        requestModifier,\r\n        dashMetrics,\r\n        settings,\r\n        mediaPlayerModel,\r\n        urlLoader,\r\n        events,\r\n        eventBus,\r\n        errors,\r\n        constants,\r\n        dashConstants,\r\n        urlUtils,\r\n        baseURLController;\r\n\r\n    function setup() {\r\n    }\r\n\r\n    function initialize() {\r\n        urlLoader = URLLoader(context).create({\r\n            errHandler: errHandler,\r\n            dashMetrics: dashMetrics,\r\n            mediaPlayerModel: mediaPlayerModel,\r\n            requestModifier: requestModifier,\r\n            useFetch: settings ? settings.get().streaming.lowLatencyEnabled : null,\r\n            boxParser: boxParser,\r\n            errors: errors,\r\n            urlUtils: urlUtils,\r\n            constants: constants,\r\n            dashConstants: dashConstants\r\n        });\r\n    }\r\n\r\n    function setConfig(config) {\r\n        if (config.baseURLController) {\r\n            baseURLController = config.baseURLController;\r\n        }\r\n\r\n        if (config.dashMetrics) {\r\n            dashMetrics = config.dashMetrics;\r\n        }\r\n\r\n        if (config.mediaPlayerModel) {\r\n            mediaPlayerModel = config.mediaPlayerModel;\r\n        }\r\n\r\n        if (config.errHandler) {\r\n            errHandler = config.errHandler;\r\n        }\r\n\r\n        if (config.settings) {\r\n            settings = config.settings;\r\n        }\r\n\r\n        if (config.boxParser) {\r\n            boxParser = config.boxParser;\r\n        }\r\n\r\n        if (config.events) {\r\n            events = config.events;\r\n        }\r\n\r\n        if (config.eventBus) {\r\n            eventBus = config.eventBus;\r\n        }\r\n\r\n        if (config.debug) {\r\n            logger = config.debug.getLogger(instance);\r\n        }\r\n\r\n        if (config.requestModifier) {\r\n            requestModifier = config.requestModifier;\r\n        }\r\n\r\n        if (config.errors) {\r\n            errors = config.errors;\r\n        }\r\n\r\n        if (config.urlUtils) {\r\n            urlUtils = config.urlUtils;\r\n        }\r\n\r\n        if (config.constants) {\r\n            constants = config.constants;\r\n        }\r\n\r\n        if (config.dashConstants) {\r\n            dashConstants = config.dashConstants;\r\n        }\r\n    }\r\n\r\n    function checkConfig() {\r\n        if (!baseURLController || !baseURLController.hasOwnProperty('resolve')) {\r\n            throw new Error('setConfig function has to be called previously');\r\n        }\r\n    }\r\n\r\n    function loadInitialization(streamId, mediaType, representation, loadingInfo) {\r\n        checkConfig();\r\n        let initRange = null;\r\n        const baseUrl = representation ? baseURLController.resolve(representation.path) : null;\r\n        const info = loadingInfo || {\r\n            init: true,\r\n            url: baseUrl ? baseUrl.url : undefined,\r\n            range: {\r\n                start: 0,\r\n                end: 1500\r\n            },\r\n            searching: false,\r\n            bytesLoaded: 0,\r\n            bytesToLoad: 1500,\r\n            mediaType: mediaType\r\n        };\r\n\r\n        logger.debug('Start searching for initialization.');\r\n\r\n        const request = getFragmentRequest(info);\r\n\r\n        const onload = function (response) {\r\n            info.bytesLoaded = info.range.end;\r\n            initRange = boxParser.findInitRange(response);\r\n\r\n            if (initRange) {\r\n                representation.range = initRange;\r\n                // note that we don't explicitly set rep.initialization as this\r\n                // will be computed when all BaseURLs are resolved later\r\n                eventBus.trigger(events.INITIALIZATION_LOADED,\r\n                    { representation: representation },\r\n                    { streamId: streamId, mediaType: mediaType }\r\n                );\r\n            } else {\r\n                info.range.end = info.bytesLoaded + info.bytesToLoad;\r\n                loadInitialization(streamId, mediaType, representation, info);\r\n            }\r\n        };\r\n\r\n        const onerror = function () {\r\n            eventBus.trigger(events.INITIALIZATION_LOADED,\r\n                { representation: representation },\r\n                { streamId: streamId, mediaType: mediaType }\r\n            );\r\n        };\r\n\r\n        urlLoader.load({request: request, success: onload, error: onerror});\r\n\r\n        logger.debug('Perform init search: ' + info.url);\r\n    }\r\n\r\n    function loadSegments(streamId, mediaType, representation, range, callback, loadingInfo) {\r\n        checkConfig();\r\n        if (range && (range.start === undefined || range.end === undefined)) {\r\n            const parts = range ? range.toString().split('-') : null;\r\n            range = parts ? {start: parseFloat(parts[0]), end: parseFloat(parts[1])} : null;\r\n        }\r\n\r\n        callback = !callback ? onLoaded : callback;\r\n        let isoFile = null;\r\n        let sidx = null;\r\n        const hasRange = !!range;\r\n        const baseUrl = representation ? baseURLController.resolve(representation.path) : null;\r\n        const info = {\r\n            init: false,\r\n            url: baseUrl ? baseUrl.url : undefined,\r\n            range: hasRange ? range : { start: 0, end: 1500 },\r\n            searching: !hasRange,\r\n            bytesLoaded: loadingInfo ? loadingInfo.bytesLoaded : 0,\r\n            bytesToLoad: 1500,\r\n            mediaType: mediaType\r\n        };\r\n\r\n        const request = getFragmentRequest(info);\r\n\r\n        const onload = function (response) {\r\n            const extraBytes = info.bytesToLoad;\r\n            const loadedLength = response.byteLength;\r\n\r\n            info.bytesLoaded = info.range.end - info.range.start;\r\n            isoFile = boxParser.parse(response);\r\n            sidx = isoFile.getBox('sidx');\r\n\r\n            if (!sidx || !sidx.isComplete) {\r\n                if (sidx) {\r\n                    info.range.start = sidx.offset || info.range.start;\r\n                    info.range.end = info.range.start + (sidx.size || extraBytes);\r\n                } else if (loadedLength < info.bytesLoaded) {\r\n                    // if we have reached a search limit or if we have reached the end of the file we have to stop trying to find sidx\r\n                    callback(streamId, mediaType, null, representation);\r\n                    return;\r\n                } else {\r\n                    const lastBox = isoFile.getLastBox();\r\n\r\n                    if (lastBox && lastBox.size) {\r\n                        info.range.start = lastBox.offset + lastBox.size;\r\n                        info.range.end = info.range.start + extraBytes;\r\n                    } else {\r\n                        info.range.end += extraBytes;\r\n                    }\r\n                }\r\n                loadSegments(streamId, mediaType, representation, info.range, callback, info);\r\n            } else {\r\n                const ref = sidx.references;\r\n                let loadMultiSidx,\r\n                    segments;\r\n\r\n                if (ref !== null && ref !== undefined && ref.length > 0) {\r\n                    loadMultiSidx = (ref[0].reference_type === 1);\r\n                }\r\n\r\n                if (loadMultiSidx) {\r\n                    logger.debug('Initiate multiple SIDX load.');\r\n                    info.range.end = info.range.start + sidx.size;\r\n\r\n                    let j, len, ss, se, r;\r\n                    let segs = [];\r\n                    let count = 0;\r\n                    let offset = (sidx.offset || info.range.start) + sidx.size;\r\n                    const tmpCallback = function (streamId, mediaType, result) {\r\n                        if (result) {\r\n                            segs = segs.concat(result);\r\n                            count++;\r\n\r\n                            if (count >= len) {\r\n                                // http requests can be processed in a wrong order, so, we have to reorder segments with an ascending start Time order\r\n                                segs.sort(function (a, b) {\r\n                                    return a.startTime - b.startTime < 0 ? -1 : 0;\r\n                                });\r\n                                callback(streamId, mediaType, segs, representation);\r\n                            }\r\n                        } else {\r\n                            callback(streamId, mediaType, null, representation);\r\n                        }\r\n                    };\r\n\r\n                    for (j = 0, len = ref.length; j < len; j++) {\r\n                        ss = offset;\r\n                        se = offset + ref[j].referenced_size - 1;\r\n                        offset = offset + ref[j].referenced_size;\r\n                        r = {start: ss, end: se};\r\n                        loadSegments(streamId, mediaType, representation, r, tmpCallback, info);\r\n                    }\r\n\r\n                } else {\r\n                    logger.debug('Parsing segments from SIDX. representation ' + mediaType + ' - id: ' + representation.id + ' for range : ' + info.range.start + ' - ' + info.range.end);\r\n                    segments = getSegmentsForSidx(sidx, info);\r\n                    callback(streamId, mediaType, segments, representation);\r\n                }\r\n            }\r\n        };\r\n\r\n        const onerror = function () {\r\n            callback(streamId, mediaType, null, representation);\r\n        };\r\n\r\n        urlLoader.load({request: request, success: onload, error: onerror});\r\n        logger.debug('Perform SIDX load: ' + info.url + ' with range : ' + info.range.start + ' - ' + info.range.end);\r\n    }\r\n\r\n    function reset() {\r\n        urlLoader.abort();\r\n        urlLoader = null;\r\n        errHandler = null;\r\n        boxParser = null;\r\n        requestModifier = null;\r\n    }\r\n\r\n    function getSegmentsForSidx(sidx, info) {\r\n        const refs = sidx.references;\r\n        const len = refs.length;\r\n        const timescale = sidx.timescale;\r\n        let time = sidx.earliest_presentation_time;\r\n        let start = info.range.start + sidx.offset + sidx.first_offset + sidx.size;\r\n        const segments = [];\r\n        let segment,\r\n            end,\r\n            duration,\r\n            size;\r\n\r\n        for (let i = 0; i < len; i++) {\r\n            duration = refs[i].subsegment_duration;\r\n            size = refs[i].referenced_size;\r\n\r\n            segment = new Segment();\r\n            // note that we don't explicitly set segment.media as this will be\r\n            // computed when all BaseURLs are resolved later\r\n            segment.duration = duration;\r\n            segment.startTime = time;\r\n            segment.timescale = timescale;\r\n            end = start + size - 1;\r\n            segment.mediaRange = start + '-' + end;\r\n            segments.push(segment);\r\n            time += duration;\r\n            start += size;\r\n        }\r\n\r\n        return segments;\r\n    }\r\n\r\n    function getFragmentRequest(info) {\r\n        if (!info.url) {\r\n            return;\r\n        }\r\n        const request = new FragmentRequest();\r\n        request.setInfo(info);\r\n        return request;\r\n    }\r\n\r\n    function onLoaded(streamId, mediaType, segments, representation) {\r\n        eventBus.trigger(events.SEGMENTS_LOADED,\r\n            {\r\n                segments: segments,\r\n                representation: representation,\r\n                error: segments ? undefined : new DashJSError(errors.SEGMENT_BASE_LOADER_ERROR_CODE, errors.SEGMENT_BASE_LOADER_ERROR_MESSAGE)\r\n            },\r\n            { streamId: streamId, mediaType: mediaType }\r\n        );\r\n    }\r\n\r\n    instance = {\r\n        setConfig: setConfig,\r\n        initialize: initialize,\r\n        loadInitialization: loadInitialization,\r\n        loadSegments: loadSegments,\r\n        reset: reset\r\n    };\r\n\r\n    setup();\r\n\r\n    return instance;\r\n}\r\n\r\nSegmentBaseLoader.__dashjs_factory_name = 'SegmentBaseLoader';\r\nexport default FactoryMaker.getSingletonFactory(SegmentBaseLoader);\r\n"]}