{"version":3,"sources":["../../../../../src/dash/parser/objectiron.js"],"names":["ObjectIron","mappers","mergeValues","parentItem","childItem","name","hasOwnProperty","mapProperties","properties","parent","child","i","len","length","property","merge","parentValue","childValue","mapItem","item","node","children","array","v","len2","childNode","run","source","Period_asArray","periodMapper","period","periods","adaptationSets","AdaptationSet_asArray","adaptationSetMapper","adaptationset","__dashjs_factory_name","factory","FactoryMaker","getClassFactory"],"mappings":"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","file":"objectiron.js","sourcesContent":["/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\nimport FactoryMaker from '../../core/FactoryMaker';\r\n\r\nfunction ObjectIron(mappers) {\r\n\r\n    function mergeValues(parentItem, childItem) {\r\n        for (let name in parentItem) {\r\n            if (!childItem.hasOwnProperty(name)) {\r\n                childItem[name] = parentItem[name];\r\n            }\r\n        }\r\n    }\r\n\r\n    function mapProperties(properties, parent, child) {\r\n        for (let i = 0, len = properties.length; i < len; ++i) {\r\n            const property = properties[i];\r\n\r\n            if (parent[property.name]) {\r\n                if (child[property.name]) {\r\n                    // check to see if we should merge\r\n                    if (property.merge) {\r\n                        const parentValue = parent[property.name];\r\n                        const childValue = child[property.name];\r\n\r\n                        // complex objects; merge properties\r\n                        if (typeof parentValue === 'object' && typeof childValue === 'object') {\r\n                            mergeValues(parentValue, childValue);\r\n                        }\r\n                        // simple objects; merge them together\r\n                        else {\r\n                            child[property.name] = parentValue + childValue;\r\n                        }\r\n                    }\r\n                } else {\r\n                    // just add the property\r\n                    child[property.name] = parent[property.name];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function mapItem(item, node) {\r\n        for (let i = 0, len = item.children.length; i < len; ++i) {\r\n            const childItem = item.children[i];\r\n\r\n            const array = node[childItem.name + '_asArray'];\r\n            if (array) {\r\n                for (let v = 0, len2 = array.length; v < len2; ++v) {\r\n                    const childNode = array[v];\r\n                    mapProperties(item.properties, node, childNode);\r\n                    mapItem(childItem, childNode);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function run(source) {\r\n\r\n        if (source === null || typeof source !== 'object') {\r\n            return source;\r\n        }\r\n\r\n        if (source.Period_asArray && 'period' in mappers) {\r\n            const periodMapper = mappers.period;\r\n            const periods = source.Period_asArray;\r\n            for (let i = 0, len = periods.length; i < len; ++i) {\r\n                const period = periods[i];\r\n                mapItem(periodMapper, period);\r\n\r\n                if ('adaptationset' in mappers) {\r\n                    const adaptationSets = period.AdaptationSet_asArray;\r\n                    if (adaptationSets) {\r\n                        const adaptationSetMapper = mappers.adaptationset;\r\n                        for (let i = 0, len = adaptationSets.length; i < len; ++i) {\r\n                            mapItem(adaptationSetMapper, adaptationSets[i]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return source;\r\n    }\r\n\r\n    return {\r\n        run: run\r\n    };\r\n}\r\n\r\n\r\nObjectIron.__dashjs_factory_name = 'ObjectIron';\r\nconst factory = FactoryMaker.getClassFactory(ObjectIron);\r\nexport default factory;\r\n"]}