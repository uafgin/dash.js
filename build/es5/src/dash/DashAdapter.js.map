{"version":3,"sources":["../../../../src/dash/DashAdapter.js"],"names":["DashAdapter","instance","dashManifestModel","patchManifestModel","voPeriods","voAdaptations","currentMediaInfo","constants","cea608parser","context","PROFILE_DVB","setup","getInstance","reset","getVoAdaptations","getVoPeriods","setConfig","config","errHandler","BASE64","convertRepresentationToRepresentationInfo","voRepresentation","representationInfo","RepresentationInfo","realAdaptation","adaptation","period","mpd","manifest","Period_asArray","index","AdaptationSet_asArray","realRepresentation","getRepresentationFor","id","quality","bandwidth","getBandwidth","DVRWindow","segmentAvailabilityRange","fragmentDuration","segmentDuration","segments","length","duration","NaN","MSETimeOffset","mediaInfo","convertAdaptationToMediaInfo","getMediaInfoForType","streamInfo","type","selectedVoPeriod","getPeriodForStreamInfo","periodId","getAdaptationsForPeriod","getAdaptationForType","idx","getIndexForAdaptation","getIsMain","getRolesForAdaptation","filter","role","value","DashConstants","MAIN","periodIndex","adaptations","getAdaptationsForType","allMediaInfoForType","getAllMediaInfoForType","i","ln","areMediaInfosEqual","mInfoOne","mInfoTwo","sameId","sameViewpoint","viewpoint","sameLang","lang","sameRoles","roles","toString","sameAccessibility","accessibility","sameAudioChannelConfiguration","audioChannelConfiguration","externalManifest","voLocalPeriods","mediaArr","data","media","j","checkConfig","getRegularPeriods","adaptationsForType","EMBEDDED_TEXT","VIDEO","accessibilityLength","indexOf","substring","parts","split","call","convertVideoInfoToEmbeddedTextInfo","push","CC1","IMAGE","convertVideoInfoToThumbnailInfo","updatePeriods","newManifest","getStreamsInfo","maxStreamsInfo","streams","convertPeriodToStreamInfo","getRealAdaptation","getAdaptationForId","getAdaptationForIndex","getEssentialPropertiesForRepresentation","representation","e","getRealPeriodByIndex","getRealPeriodForIndex","getVoRepresentations","voReps","voAdaptation","getAdaptationForMediaInfo","getRepresentationsForAdaptation","getEvent","eventBox","eventStreams","mediaStartTime","isNaN","schemeIdUri","scheme_id_uri","event","Event","timescale","periodStart","start","eventStream","presentationTimeOffset","presentationTimeDelta","presentation_time_delta","calculatedPresentationTime","version","event_duration","messageData","message_data","getEventsFor","info","events","StreamInfo","getEventsForPeriod","MediaInfo","getEventStreamForAdaptationSet","getEventStreamForRepresentation","setCurrentMediaInfo","streamId","getIsTextTrack","getUTCTimingSources","getManifest","getSuggestedPresentationDelay","getAvailabilityStartTime","getMpd","getIsDynamic","getDuration","getLocation","getManifestUpdatePeriod","latencyOfLastUpdate","getPublishTime","getPatchLocation","patchLocation","publishTime","hasOwnProperty","ttl","parseFloat","getTime","Date","__text","getIsDVB","hasProfile","getIsPatch","getBaseURLsFromElement","node","getRepresentationSortFunction","getCodec","representationId","addResolutionInfo","getBandwidthForRepresentation","periodIdx","getPeriod","findRepresentation","getIndexForRepresentation","findRepresentationIndex","getMaxIndexForBufferType","bufferType","findMaxBufferIndex","getPeriodById","periods","p","getIsTypeOf","isPatchValid","patch","manifestId","getId","patchManifestId","getMpdId","manifestPublishTime","patchPublishTime","originalManifestPublishTime","getOriginalPublishTime","applyPatchToManifest","getPatchOperations","forEach","operation","result","getMpdTarget","name","target","leaf","xpath","findsAttribute","action","relativePosition","insertBefore","position","targetArray","splice","Object","keys","insert","insertNodes","updatedNodes","apply","concat","undefined","voPeriodsArray","voPeriod","representationCount","getRepresentationCount","labels","getLabelsForAdaptation","getLanguageForAdaptation","getViewpointForAdaptation","getAccessibilityForAdaptation","map","accessibilityValue","accessibilityData","search","embeddedCaptions","getAudioChannelConfigurationForAdaptation","Array","isArray","Representation_asArray","getAudioChannelConfigurationForRepresentation","codec","mimeType","getMimeType","contentProtection","getContentProtectionData","bitrateList","getBitrateListForAdaptation","item","KID","getKID","isText","supplementalProperties","getSupplementalPropperties","channel","parseInt","isEmbedded","THRESHOLD","manifestInfo","convertMpdToManifestInfo","isLast","Math","abs","ManifestInfo","DVRWindowSize","timeShiftBufferDepth","loadedTime","availableFrom","availabilityStartTime","minBufferTime","maxFragmentDuration","maxSegmentDuration","isDynamic","serviceDescriptions","getServiceDescriptions","protocol","Error","returnIndex","adaptationSet","adaptationSetArray","representationArray","adaptationSetArrayIndex","representationArrayIndex","convertDataToRepresentationInfo","getDataForMedia","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"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","file":"DashAdapter.js","sourcesContent":["/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport DashConstants from './constants/DashConstants';\r\nimport RepresentationInfo from './vo/RepresentationInfo';\r\nimport MediaInfo from './vo/MediaInfo';\r\nimport StreamInfo from './vo/StreamInfo';\r\nimport ManifestInfo from './vo/ManifestInfo';\r\nimport Event from './vo/Event';\r\nimport FactoryMaker from '../core/FactoryMaker';\r\nimport DashManifestModel from './models/DashManifestModel';\r\nimport PatchManifestModel from './models/PatchManifestModel';\r\n\r\n/**\r\n * @module DashAdapter\r\n */\r\n\r\nfunction DashAdapter() {\r\n    let instance,\r\n        dashManifestModel,\r\n        patchManifestModel,\r\n        voPeriods,\r\n        voAdaptations,\r\n        currentMediaInfo,\r\n        constants,\r\n        cea608parser;\r\n\r\n    const context = this.context;\r\n\r\n    const PROFILE_DVB = 'urn:dvb:dash:profile:dvb-dash:2014';\r\n\r\n    function setup() {\r\n        dashManifestModel = DashManifestModel(context).getInstance();\r\n        patchManifestModel = PatchManifestModel(context).getInstance();\r\n        reset();\r\n    }\r\n\r\n    // #region PUBLIC FUNCTIONS\r\n    // --------------------------------------------------\r\n    function getVoAdaptations() {\r\n        return voAdaptations;\r\n    }\r\n\r\n    function getVoPeriods() {\r\n        return voPeriods;\r\n    }\r\n\r\n    function setConfig(config) {\r\n        if (!config) return;\r\n\r\n        if (config.constants) {\r\n            constants = config.constants;\r\n        }\r\n\r\n        if (config.cea608parser) {\r\n            cea608parser = config.cea608parser;\r\n        }\r\n\r\n        if (config.errHandler) {\r\n            dashManifestModel.setConfig({ errHandler: config.errHandler });\r\n        }\r\n\r\n        if (config.BASE64) {\r\n            dashManifestModel.setConfig({ BASE64: config.BASE64 });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates an instance of RepresentationInfo based on a representation value object\r\n     * @param {object} voRepresentation\r\n     * @returns {RepresentationInfo|null} representationInfo\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function convertRepresentationToRepresentationInfo(voRepresentation) {\r\n        if (voRepresentation) {\r\n            let representationInfo = new RepresentationInfo();\r\n            const realAdaptation = voRepresentation.adaptation.period.mpd.manifest.Period_asArray[voRepresentation.adaptation.period.index].AdaptationSet_asArray[voRepresentation.adaptation.index];\r\n            const realRepresentation = dashManifestModel.getRepresentationFor(voRepresentation.index, realAdaptation);\r\n\r\n            representationInfo.id = voRepresentation.id;\r\n            representationInfo.quality = voRepresentation.index;\r\n            representationInfo.bandwidth = dashManifestModel.getBandwidth(realRepresentation);\r\n            representationInfo.DVRWindow = voRepresentation.segmentAvailabilityRange;\r\n            representationInfo.fragmentDuration = voRepresentation.segmentDuration || (voRepresentation.segments && voRepresentation.segments.length > 0 ? voRepresentation.segments[0].duration : NaN);\r\n            representationInfo.MSETimeOffset = voRepresentation.MSETimeOffset;\r\n            representationInfo.mediaInfo = convertAdaptationToMediaInfo(voRepresentation.adaptation);\r\n\r\n            return representationInfo;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns a MediaInfo object for a given media type.\r\n     * @param {object} streamInfo\r\n     * @param {MediaType }type\r\n     * @returns {null|MediaInfo} mediaInfo\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getMediaInfoForType(streamInfo, type) {\r\n        if (voPeriods.length === 0 || !streamInfo) {\r\n            return null;\r\n        }\r\n\r\n        let selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voPeriods);\r\n        if (!selectedVoPeriod) return null;\r\n\r\n        let periodId = selectedVoPeriod.id;\r\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\r\n\r\n        let realAdaptation = getAdaptationForType(streamInfo.index, type, streamInfo);\r\n        if (!realAdaptation) return null;\r\n        let idx = dashManifestModel.getIndexForAdaptation(realAdaptation, voPeriods[0].mpd.manifest, streamInfo.index);\r\n\r\n        return convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\r\n    }\r\n\r\n    /**\r\n     * Checks if the role of the specified AdaptationSet is set to main\r\n     * @param {object} adaptation\r\n     * @returns {boolean}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getIsMain(adaptation) {\r\n        return dashManifestModel.getRolesForAdaptation(adaptation).filter(function (role) {\r\n            return role.value === DashConstants.MAIN;\r\n        })[0];\r\n    }\r\n\r\n    /**\r\n     * Returns the AdaptationSet for a given period and a given mediaType.\r\n     * @param {number} periodIndex\r\n     * @param {MediaType} type\r\n     * @param {object} streamInfo\r\n     * @returns {null|object} adaptation\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getAdaptationForType(periodIndex, type, streamInfo) {\r\n        const adaptations = dashManifestModel.getAdaptationsForType(voPeriods[0].mpd.manifest, periodIndex, type);\r\n\r\n        if (!adaptations || adaptations.length === 0) return null;\r\n\r\n        if (adaptations.length > 1 && streamInfo) {\r\n            const allMediaInfoForType = getAllMediaInfoForType(streamInfo, type);\r\n\r\n            if (currentMediaInfo[streamInfo.id] && currentMediaInfo[streamInfo.id][type]) {\r\n                for (let i = 0, ln = adaptations.length; i < ln; i++) {\r\n                    if (areMediaInfosEqual(currentMediaInfo[streamInfo.id][type], allMediaInfoForType[i])) {\r\n                        return adaptations[i];\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i = 0, ln = adaptations.length; i < ln; i++) {\r\n                if (getIsMain(adaptations[i])) {\r\n                    return adaptations[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        return adaptations[0];\r\n    }\r\n\r\n    /**\r\n     * Compares two mediaInfo objects\r\n     * @param {MediaInfo} mInfoOne\r\n     * @param {MediaInfo} mInfoTwo\r\n     * @returns {boolean}\r\n     */\r\n    function areMediaInfosEqual(mInfoOne, mInfoTwo) {\r\n        if (!mInfoOne || !mInfoTwo) {\r\n            return false;\r\n        }\r\n\r\n        const sameId = mInfoOne.id === mInfoTwo.id;\r\n        const sameViewpoint = mInfoOne.viewpoint === mInfoTwo.viewpoint;\r\n        const sameLang = mInfoOne.lang === mInfoTwo.lang;\r\n        const sameRoles = mInfoOne.roles.toString() === mInfoTwo.roles.toString();\r\n        const sameAccessibility = mInfoOne.accessibility.toString() === mInfoTwo.accessibility.toString();\r\n        const sameAudioChannelConfiguration = mInfoOne.audioChannelConfiguration.toString() === mInfoTwo.audioChannelConfiguration.toString();\r\n\r\n        return (sameId && sameViewpoint && sameLang && sameRoles && sameAccessibility && sameAudioChannelConfiguration);\r\n    }\r\n\r\n    /**\r\n     * Returns the mediaInfo for a given mediaType\r\n     * @param {object} streamInfo\r\n     * @param {MediaType} type\r\n     * @param {object} externalManifest Set to null or undefined if no external manifest is to be used\r\n     * @returns {Array} mediaArr\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getAllMediaInfoForType(streamInfo, type, externalManifest) {\r\n        let voLocalPeriods = voPeriods;\r\n        let manifest = externalManifest;\r\n        let mediaArr = [];\r\n        let data,\r\n            media,\r\n            idx,\r\n            i,\r\n            j,\r\n            ln,\r\n            periodId;\r\n\r\n        if (manifest) {\r\n            checkConfig();\r\n\r\n            voLocalPeriods = getRegularPeriods(manifest);\r\n        } else {\r\n            if (voPeriods.length > 0) {\r\n                manifest = voPeriods[0].mpd.manifest;\r\n            } else {\r\n                return mediaArr;\r\n            }\r\n        }\r\n\r\n        const selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voLocalPeriods);\r\n        if (selectedVoPeriod) {\r\n            periodId = selectedVoPeriod.id;\r\n        }\r\n        const adaptationsForType = dashManifestModel.getAdaptationsForType(manifest, streamInfo ? streamInfo.index : null, type !== constants.EMBEDDED_TEXT ? type : constants.VIDEO);\r\n\r\n        if (!adaptationsForType || adaptationsForType.length === 0) return mediaArr;\r\n\r\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\r\n\r\n        for (i = 0, ln = adaptationsForType.length; i < ln; i++) {\r\n            data = adaptationsForType[i];\r\n            idx = dashManifestModel.getIndexForAdaptation(data, manifest, streamInfo.index);\r\n            media = convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\r\n\r\n            if (type === constants.EMBEDDED_TEXT) {\r\n                let accessibilityLength = media.accessibility.length;\r\n                for (j = 0; j < accessibilityLength; j++) {\r\n                    if (!media) {\r\n                        continue;\r\n                    }\r\n                    let accessibility = media.accessibility[j];\r\n                    if (accessibility.indexOf('cea-608:') === 0) {\r\n                        let value = accessibility.substring(8);\r\n                        let parts = value.split(';');\r\n                        if (parts[0].substring(0, 2) === 'CC') {\r\n                            for (j = 0; j < parts.length; j++) {\r\n                                if (!media) {\r\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\r\n                                }\r\n                                convertVideoInfoToEmbeddedTextInfo(media, parts[j].substring(0, 3), parts[j].substring(4));\r\n                                mediaArr.push(media);\r\n                                media = null;\r\n                            }\r\n                        } else {\r\n                            for (j = 0; j < parts.length; j++) { // Only languages for CC1, CC2, ...\r\n                                if (!media) {\r\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\r\n                                }\r\n                                convertVideoInfoToEmbeddedTextInfo(media, 'CC' + (j + 1), parts[j]);\r\n                                mediaArr.push(media);\r\n                                media = null;\r\n                            }\r\n                        }\r\n                    } else if (accessibility.indexOf('cea-608') === 0) { // Nothing known. We interpret it as CC1=eng\r\n                        convertVideoInfoToEmbeddedTextInfo(media, constants.CC1, 'eng');\r\n                        mediaArr.push(media);\r\n                        media = null;\r\n                    }\r\n                }\r\n            } else if (type === constants.IMAGE) {\r\n                convertVideoInfoToThumbnailInfo(media);\r\n                mediaArr.push(media);\r\n                media = null;\r\n            } else if (media) {\r\n                mediaArr.push(media);\r\n            }\r\n        }\r\n\r\n        return mediaArr;\r\n    }\r\n\r\n    /**\r\n     * @param {object} newManifest\r\n     * @returns {*}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function updatePeriods(newManifest) {\r\n        if (!newManifest) return null;\r\n\r\n        checkConfig();\r\n\r\n        voPeriods = getRegularPeriods(newManifest);\r\n\r\n        voAdaptations = {};\r\n    }\r\n\r\n    /**\r\n     * @param {object} externalManifest\r\n     * @param {number} maxStreamsInfo\r\n     * @returns {Array} streams\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getStreamsInfo(externalManifest, maxStreamsInfo) {\r\n        const streams = [];\r\n        let voLocalPeriods = voPeriods;\r\n\r\n        //if manifest is defined, getStreamsInfo is for an outside manifest, not the current one\r\n        if (externalManifest) {\r\n            checkConfig();\r\n            voLocalPeriods = getRegularPeriods(externalManifest);\r\n        }\r\n\r\n        if (voLocalPeriods.length > 0) {\r\n            if (!maxStreamsInfo || maxStreamsInfo > voLocalPeriods.length) {\r\n                maxStreamsInfo = voLocalPeriods.length;\r\n            }\r\n            for (let i = 0; i < maxStreamsInfo; i++) {\r\n                streams.push(convertPeriodToStreamInfo(voLocalPeriods[i]));\r\n            }\r\n        }\r\n\r\n        return streams;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {object} streamInfo\r\n     * @param {object} mediaInfo\r\n     * @returns {object} realAdaptation\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getRealAdaptation(streamInfo, mediaInfo) {\r\n        let id,\r\n            realAdaptation;\r\n\r\n        const selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voPeriods);\r\n\r\n        id = mediaInfo ? mediaInfo.id : null;\r\n\r\n        if (voPeriods.length > 0 && selectedVoPeriod) {\r\n            realAdaptation = id ? dashManifestModel.getAdaptationForId(id, voPeriods[0].mpd.manifest, selectedVoPeriod.index) : dashManifestModel.getAdaptationForIndex(mediaInfo ? mediaInfo.index : null, voPeriods[0].mpd.manifest, selectedVoPeriod.index);\r\n        }\r\n\r\n        return realAdaptation;\r\n    }\r\n\r\n    /**\r\n     * Return all EssentialProperties of a Representation\r\n     * @param {object} representation\r\n     * @return {array}\r\n     */\r\n    function getEssentialPropertiesForRepresentation(representation) {\r\n        try {\r\n            return dashManifestModel.getEssentialPropertiesForRepresentation(representation);\r\n        } catch (e) {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the period by index\r\n     * @param {number} index\r\n     * @return {object}\r\n     */\r\n    function getRealPeriodByIndex(index) {\r\n        return dashManifestModel.getRealPeriodForIndex(index, voPeriods[0].mpd.manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns all voRepresentations for a given mediaInfo\r\n     * @param {object} mediaInfo\r\n     * @returns {Array} voReps\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getVoRepresentations(mediaInfo) {\r\n        let voReps;\r\n\r\n        const voAdaptation = getAdaptationForMediaInfo(mediaInfo);\r\n        voReps = dashManifestModel.getRepresentationsForAdaptation(voAdaptation);\r\n\r\n        return voReps;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {object} eventBox\r\n     * @param {object} eventStreams\r\n     * @param {number} mediaStartTime\r\n     * @param {object} voRepresentation\r\n     * @returns {null|Event}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getEvent(eventBox, eventStreams, mediaStartTime, voRepresentation) {\r\n        try {\r\n            if (!eventBox || !eventStreams || isNaN(mediaStartTime) || !voRepresentation) {\r\n                return null;\r\n            }\r\n\r\n            const schemeIdUri = eventBox.scheme_id_uri;\r\n            const value = eventBox.value;\r\n\r\n            if (!eventStreams[schemeIdUri + '/' + value]) {\r\n                return null;\r\n            }\r\n\r\n            const event = new Event();\r\n            const timescale = eventBox.timescale || 1;\r\n            const periodStart = voRepresentation.adaptation.period.start;\r\n            const eventStream = eventStreams[schemeIdUri + '/' + value];\r\n            const presentationTimeOffset = !isNaN(voRepresentation.presentationTimeOffset) ? voRepresentation.presentationTimeOffset : !isNaN(eventStream.presentationTimeOffset) ? eventStream.presentationTimeOffset : 0;\r\n            let presentationTimeDelta = eventBox.presentation_time_delta / timescale; // In case of version 1 events the presentation_time is parsed as presentation_time_delta\r\n            let calculatedPresentationTime;\r\n\r\n            if (eventBox.version === 0) {\r\n                calculatedPresentationTime = periodStart + mediaStartTime - presentationTimeOffset + presentationTimeDelta;\r\n            } else {\r\n                calculatedPresentationTime = periodStart - presentationTimeOffset + presentationTimeDelta;\r\n            }\r\n\r\n            const duration = eventBox.event_duration;\r\n            const id = eventBox.id;\r\n            const messageData = eventBox.message_data;\r\n\r\n            event.eventStream = eventStream;\r\n            event.eventStream.value = value;\r\n            event.eventStream.timescale = timescale;\r\n            event.duration = duration;\r\n            event.id = id;\r\n            event.calculatedPresentationTime = calculatedPresentationTime;\r\n            event.messageData = messageData;\r\n            event.presentationTimeDelta = presentationTimeDelta;\r\n\r\n            return event;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {object} info\r\n     * @param {object} voRepresentation\r\n     * @returns {Array}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getEventsFor(info, voRepresentation) {\r\n        let events = [];\r\n\r\n        if (voPeriods.length > 0) {\r\n            const manifest = voPeriods[0].mpd.manifest;\r\n\r\n            if (info instanceof StreamInfo) {\r\n                events = dashManifestModel.getEventsForPeriod(getPeriodForStreamInfo(info, voPeriods));\r\n            } else if (info instanceof MediaInfo) {\r\n                events = dashManifestModel.getEventStreamForAdaptationSet(manifest, getAdaptationForMediaInfo(info));\r\n            } else if (info instanceof RepresentationInfo) {\r\n                events = dashManifestModel.getEventStreamForRepresentation(manifest, voRepresentation);\r\n            }\r\n        }\r\n\r\n        return events;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {number} streamId\r\n     * @param {MediaType} type\r\n     * @param {object} mediaInfo\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function setCurrentMediaInfo(streamId, type, mediaInfo) {\r\n        currentMediaInfo[streamId] = currentMediaInfo[streamId] || {};\r\n        currentMediaInfo[streamId][type] = currentMediaInfo[streamId][type] || {};\r\n        currentMediaInfo[streamId][type] = mediaInfo;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {String} type\r\n     * @returns {boolean}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getIsTextTrack(type) {\r\n        return dashManifestModel.getIsTextTrack(type);\r\n    }\r\n\r\n    /**\r\n     * Returns the UTC Timing Sources specified in the manifest\r\n     * @returns {Array} utcTimingSources\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getUTCTimingSources() {\r\n        const manifest = getManifest();\r\n        return dashManifestModel.getUTCTimingSources(manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns the suggestedPresentationDelay as specified in the manifest\r\n     * @returns {String} suggestedPresentationDelay\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getSuggestedPresentationDelay() {\r\n        const mpd = voPeriods.length > 0 ? voPeriods[0].mpd : null;\r\n        return dashManifestModel.getSuggestedPresentationDelay(mpd);\r\n    }\r\n\r\n    /**\r\n     * Returns the availabilityStartTime as specified in the manifest\r\n     * @param {object} externalManifest Omit this value if no external manifest should be used\r\n     * @returns {string} availabilityStartTime\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getAvailabilityStartTime(externalManifest) {\r\n        const mpd = getMpd(externalManifest);\r\n        return dashManifestModel.getAvailabilityStartTime(mpd);\r\n    }\r\n\r\n    /**\r\n     * Returns a boolean indicating if the manifest is dynamic or not\r\n     * @param {object} externalManifest Omit this value if no external manifest should be used\r\n     * @returns {boolean}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getIsDynamic(externalManifest) {\r\n        const manifest = getManifest(externalManifest);\r\n        return dashManifestModel.getIsDynamic(manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns the duration of the MPD\r\n     * @param {object} externalManifest Omit this value if no external manifest should be used\r\n     * @returns {number} duration\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getDuration(externalManifest) {\r\n        const manifest = getManifest(externalManifest);\r\n        return dashManifestModel.getDuration(manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns all periods of the MPD\r\n     * @param {object} externalManifest Omit this value if no external manifest should be used\r\n     * @returns {Array} periods\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getRegularPeriods(externalManifest) {\r\n        const mpd = getMpd(externalManifest);\r\n        return dashManifestModel.getRegularPeriods(mpd);\r\n    }\r\n\r\n    /**\r\n     * Returns an MPD object\r\n     * @param {object} externalManifest Omit this value if no external manifest should be used\r\n     * @returns {object} MPD\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getMpd(externalManifest) {\r\n        const manifest = getManifest(externalManifest);\r\n        return dashManifestModel.getMpd(manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns the location element of the MPD\r\n     * @param {object} manifest\r\n     * @returns {String} location\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getLocation(manifest) {\r\n        return dashManifestModel.getLocation(manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns the manifest update period used for dynamic manifests\r\n     * @param {object} manifest\r\n     * @param {number} latencyOfLastUpdate\r\n     * @returns {NaN|number} manifestUpdatePeriod\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getManifestUpdatePeriod(manifest, latencyOfLastUpdate = 0) {\r\n        return dashManifestModel.getManifestUpdatePeriod(manifest, latencyOfLastUpdate);\r\n    }\r\n\r\n    /**\r\n     * Returns the publish time from the manifest\r\n     * @param {object} manifest\r\n     * @returns {Date|null} publishTime\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getPublishTime(manifest) {\r\n        return dashManifestModel.getPublishTime(manifest);\r\n    }\r\n\r\n    /**\r\n     * Returns the patch location of the MPD if one exists and it is still valid\r\n     * @param {object} manifest\r\n     * @returns {(String|null)} patch location\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getPatchLocation(manifest) {\r\n        const patchLocation = dashManifestModel.getPatchLocation(manifest);\r\n        const publishTime = dashManifestModel.getPublishTime(manifest);\r\n\r\n        // short-circuit when no patch location or publish time exists\r\n        if (!patchLocation || !publishTime) {\r\n            return null;\r\n        }\r\n\r\n        // if a ttl is provided, ensure patch location has not expired\r\n        if (patchLocation.hasOwnProperty('ttl') && publishTime) {\r\n            // attribute describes number of seconds as a double\r\n            const ttl = parseFloat(patchLocation.ttl) * 1000;\r\n\r\n            // check if the patch location has expired, if so do not consider it\r\n            if (publishTime.getTime() + ttl <= new Date().getTime()) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        // the patch location exists and, if a ttl applies, has not expired\r\n        return patchLocation.__text;\r\n    }\r\n\r\n    /**\r\n     * Checks if the manifest has a DVB profile\r\n     * @param {object} manifest\r\n     * @returns {boolean}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getIsDVB(manifest) {\r\n        return dashManifestModel.hasProfile(manifest, PROFILE_DVB);\r\n    }\r\n\r\n    /**\r\n     * Checks if the manifest is actually just a patch manifest\r\n     * @param  {object} manifest\r\n     * @return {boolean}\r\n     */\r\n    function getIsPatch(manifest) {\r\n        return patchManifestModel.getIsPatch(manifest);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {object} node\r\n     * @returns {Array}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getBaseURLsFromElement(node) {\r\n        return dashManifestModel.getBaseURLsFromElement(node);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {*}\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     * @ignore\r\n     */\r\n    function getRepresentationSortFunction() {\r\n        return dashManifestModel.getRepresentationSortFunction();\r\n    }\r\n\r\n    /**\r\n     * Returns the codec for a given adaptation set and a given representation id.\r\n     * @param {object} adaptation\r\n     * @param {number} representationId\r\n     * @param {boolean} addResolutionInfo Defines whether to include resolution information in the output\r\n     * @returns {String} codec\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getCodec(adaptation, representationId, addResolutionInfo) {\r\n        return dashManifestModel.getCodec(adaptation, representationId, addResolutionInfo);\r\n    }\r\n\r\n    /**\r\n     * Returns the bandwidth for a given representation id\r\n     * @param {number} representationId\r\n     * @param {number} periodIdx\r\n     * @returns {number} bandwidth\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getBandwidthForRepresentation(representationId, periodIdx) {\r\n        let representation;\r\n        let period = getPeriod(periodIdx);\r\n\r\n        representation = findRepresentation(period, representationId);\r\n\r\n        return representation ? representation.bandwidth : null;\r\n    }\r\n\r\n    /**\r\n     * Returns the index for a given representation id\r\n     * @param {string} representationId\r\n     * @param {number} periodIdx\r\n     * @returns {number} index\r\n     * @memberOf module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getIndexForRepresentation(representationId, periodIdx) {\r\n        let period = getPeriod(periodIdx);\r\n\r\n        return findRepresentationIndex(period, representationId);\r\n    }\r\n\r\n    /**\r\n     * This method returns the current max index based on what is defined in the MPD.\r\n     *\r\n     * @param {string} bufferType - String 'audio' or 'video',\r\n     * @param {number} periodIdx - Make sure this is the period index not id\r\n     * @return {number}\r\n     * @memberof module:DashAdapter\r\n     * @instance\r\n     */\r\n    function getMaxIndexForBufferType(bufferType, periodIdx) {\r\n        let period = getPeriod(periodIdx);\r\n\r\n        return findMaxBufferIndex(period, bufferType);\r\n    }\r\n\r\n    /**\r\n     * Returns the voPeriod object for a given id\r\n     * @param {String} id\r\n     * @returns {object|null}\r\n     */\r\n    function getPeriodById(id) {\r\n        if (!id || voPeriods.length === 0) {\r\n            return null;\r\n        }\r\n        const periods = voPeriods.filter((p) => {\r\n            return p.id === id;\r\n        });\r\n\r\n        if (periods && periods.length > 0) {\r\n            return periods[0];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function getIsTypeOf(adaptation, type) {\r\n        return dashManifestModel.getIsTypeOf(adaptation, type);\r\n    }\r\n\r\n    function reset() {\r\n        voPeriods = [];\r\n        voAdaptations = {};\r\n        currentMediaInfo = {};\r\n    }\r\n\r\n    /**\r\n     * Checks if the supplied manifest is compatible for application of the supplied patch\r\n     * @param  {object}  manifest\r\n     * @param  {object}  patch\r\n     * @return {boolean}\r\n     */\r\n    function isPatchValid(manifest, patch) {\r\n        let manifestId = dashManifestModel.getId(manifest);\r\n        let patchManifestId = patchManifestModel.getMpdId(patch);\r\n        let manifestPublishTime = dashManifestModel.getPublishTime(manifest);\r\n        let patchPublishTime = patchManifestModel.getPublishTime(patch);\r\n        let originalManifestPublishTime = patchManifestModel.getOriginalPublishTime(patch);\r\n\r\n        // Patches are considered compatible if the following are true\r\n        // - MPD@id == Patch@mpdId\r\n        // - MPD@publishTime == Patch@originalPublishTime\r\n        // - MPD@publishTime < Patch@publishTime\r\n        // - All values in comparison exist\r\n        return !!(manifestId && patchManifestId && (manifestId == patchManifestId) &&\r\n            manifestPublishTime && originalManifestPublishTime && (manifestPublishTime.getTime() == originalManifestPublishTime.getTime()) &&\r\n            patchPublishTime && (manifestPublishTime.getTime() < patchPublishTime.getTime()));\r\n    }\r\n\r\n    /**\r\n     * Takes a given patch and applies it to the provided manifest, assumes patch is valid for manifest\r\n     * @param  {object} manifest\r\n     * @param  {object} patch\r\n     */\r\n    function applyPatchToManifest(manifest, patch) {\r\n        // get all operations from the patch and apply them in document order\r\n        patchManifestModel.getPatchOperations(patch)\r\n            .forEach((operation) => {\r\n                let result = operation.getMpdTarget(manifest);\r\n\r\n                // operation supplies a path that doesn't match mpd, skip\r\n                if (result === null) {\r\n                    return;\r\n                }\r\n\r\n                let {name, target, leaf} = result;\r\n\r\n                // short circuit for attribute selectors\r\n                if (operation.xpath.findsAttribute()) {\r\n                    switch (operation.action) {\r\n                        case 'add':\r\n                        case 'replace':\r\n                            // add and replace are just setting the value\r\n                            target[name] = operation.value;\r\n                            break;\r\n                        case 'remove':\r\n                            // remove is deleting the value\r\n                            delete target[name];\r\n                            break;\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                // determine the relative insert position prior to possible removal\r\n                let relativePosition = (target[name + '_asArray'] || []).indexOf(leaf);\r\n                let insertBefore = (operation.position === 'prepend' || operation.position === 'before');\r\n\r\n                // perform removal operation first, we have already capture the appropriate relative position\r\n                if (operation.action === 'remove' || operation.action === 'replace') {\r\n                    // note that we ignore the 'ws' attribute of patch operations as it does not effect parsed mpd operations\r\n\r\n                    // purge the directly named entity\r\n                    delete target[name];\r\n\r\n                    // if we did have a positional reference we need to purge from array set and restore X2JS proper semantics\r\n                    if (relativePosition != -1) {\r\n                        let targetArray = target[name + '_asArray'];\r\n                        targetArray.splice(relativePosition, 1);\r\n                        if (targetArray.length > 1) {\r\n                            target[name] = targetArray;\r\n                        } else if (targetArray.length == 1) {\r\n                            // xml parsing semantics, singular asArray must be non-array in the unsuffixed key\r\n                            target[name] = targetArray[0];\r\n                        } else {\r\n                            // all nodes of this type deleted, remove entry\r\n                            delete target[name + '_asArray'];\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Perform any add/replace operations now, technically RFC5261 only allows a single element to take the\r\n                // place of a replaced element while the add case allows an arbitrary number of children.\r\n                // Due to the both operations requiring the same insertion logic they have been combined here and we will\r\n                // not enforce single child operations for replace, assertions should be made at patch parse time if necessary\r\n                if (operation.action === 'add' || operation.action === 'replace') {\r\n                    // value will be an object with element name keys pointing to arrays of objects\r\n                    Object.keys(operation.value).forEach((insert) => {\r\n                        let insertNodes = operation.value[insert];\r\n\r\n                        let updatedNodes = target[insert + '_asArray'] || [];\r\n                        if (updatedNodes.length === 0 && target[insert]) {\r\n                            updatedNodes.push(target[insert]);\r\n                        }\r\n\r\n                        if (updatedNodes.length === 0) {\r\n                            // no original nodes for this element type\r\n                            updatedNodes = insertNodes;\r\n                        } else {\r\n                            // compute the position we need to insert at, default to end of set\r\n                            let position = updatedNodes.length;\r\n                            if (insert == name && relativePosition != -1) {\r\n                                // if the inserted element matches the operation target (not leaf) and there is a relative position we\r\n                                // want the inserted position to be set such that our insertion is relative to original position\r\n                                // since replace has modified the array length we reduce the insert point by 1\r\n                                position = relativePosition + (insertBefore ? 0 : 1) + (operation.action == 'replace' ? -1 : 0);\r\n                            } else {\r\n                                // otherwise we are in an add append/prepend case or replace case that removed the target name completely\r\n                                position = insertBefore ? 0 : updatedNodes.length;\r\n                            }\r\n\r\n                            // we dont have to perform element removal for the replace case as that was done above\r\n                            updatedNodes.splice.apply(updatedNodes, [position, 0].concat(insertNodes));\r\n                        }\r\n\r\n                        // now we properly reset the element keys on the target to match parsing semantics\r\n                        target[insert + '_asArray'] = updatedNodes;\r\n                        target[insert] = updatedNodes.length == 1 ? updatedNodes[0] : updatedNodes;\r\n                    });\r\n                }\r\n            });\r\n    }\r\n\r\n    // #endregion PUBLIC FUNCTIONS\r\n\r\n    // #region PRIVATE FUNCTIONS\r\n    // --------------------------------------------------\r\n    function getManifest(externalManifest) {\r\n        return externalManifest ? externalManifest : voPeriods.length > 0 ? voPeriods[0].mpd.manifest : null;\r\n    }\r\n\r\n    function getAdaptationForMediaInfo(mediaInfo) {\r\n        if (!mediaInfo || !mediaInfo.streamInfo || mediaInfo.streamInfo.id === undefined || !voAdaptations[mediaInfo.streamInfo.id]) return null;\r\n        return voAdaptations[mediaInfo.streamInfo.id][mediaInfo.index];\r\n    }\r\n\r\n    function getPeriodForStreamInfo(streamInfo, voPeriodsArray) {\r\n        const ln = voPeriodsArray.length;\r\n\r\n        for (let i = 0; i < ln; i++) {\r\n            let voPeriod = voPeriodsArray[i];\r\n\r\n            if (streamInfo && streamInfo.id === voPeriod.id) return voPeriod;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function convertAdaptationToMediaInfo(adaptation) {\r\n        if (!adaptation) {\r\n            return null;\r\n        }\r\n\r\n        let mediaInfo = new MediaInfo();\r\n        const realAdaptation = adaptation.period.mpd.manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index];\r\n        let viewpoint;\r\n\r\n        mediaInfo.id = adaptation.id;\r\n        mediaInfo.index = adaptation.index;\r\n        mediaInfo.type = adaptation.type;\r\n        mediaInfo.streamInfo = convertPeriodToStreamInfo(adaptation.period);\r\n        mediaInfo.representationCount = dashManifestModel.getRepresentationCount(realAdaptation);\r\n        mediaInfo.labels = dashManifestModel.getLabelsForAdaptation(realAdaptation);\r\n        mediaInfo.lang = dashManifestModel.getLanguageForAdaptation(realAdaptation);\r\n        viewpoint = dashManifestModel.getViewpointForAdaptation(realAdaptation);\r\n        mediaInfo.viewpoint = viewpoint ? viewpoint.value : undefined;\r\n        mediaInfo.accessibility = dashManifestModel.getAccessibilityForAdaptation(realAdaptation).map(function (accessibility) {\r\n            let accessibilityValue = accessibility.value;\r\n            let accessibilityData = accessibilityValue;\r\n            if (accessibility.schemeIdUri && (accessibility.schemeIdUri.search('cea-608') >= 0) && typeof (cea608parser) !== 'undefined') {\r\n                if (accessibilityValue) {\r\n                    accessibilityData = 'cea-608:' + accessibilityValue;\r\n                } else {\r\n                    accessibilityData = 'cea-608';\r\n                }\r\n                mediaInfo.embeddedCaptions = true;\r\n            }\r\n            return accessibilityData;\r\n        });\r\n\r\n        mediaInfo.audioChannelConfiguration = dashManifestModel.getAudioChannelConfigurationForAdaptation(realAdaptation).map(function (audioChannelConfiguration) {\r\n            return audioChannelConfiguration.value;\r\n        });\r\n\r\n        if (mediaInfo.audioChannelConfiguration.length === 0 && Array.isArray(realAdaptation.Representation_asArray) && realAdaptation.Representation_asArray.length > 0) {\r\n            mediaInfo.audioChannelConfiguration = dashManifestModel.getAudioChannelConfigurationForRepresentation(realAdaptation.Representation_asArray[0]).map(function (audioChannelConfiguration) {\r\n                return audioChannelConfiguration.value;\r\n            });\r\n        }\r\n        mediaInfo.roles = dashManifestModel.getRolesForAdaptation(realAdaptation).map(function (role) {\r\n            return role.value;\r\n        });\r\n        mediaInfo.codec = dashManifestModel.getCodec(realAdaptation);\r\n        mediaInfo.mimeType = dashManifestModel.getMimeType(realAdaptation);\r\n        mediaInfo.contentProtection = dashManifestModel.getContentProtectionData(realAdaptation);\r\n        mediaInfo.bitrateList = dashManifestModel.getBitrateListForAdaptation(realAdaptation);\r\n\r\n        if (mediaInfo.contentProtection) {\r\n            mediaInfo.contentProtection.forEach(function (item) {\r\n                item.KID = dashManifestModel.getKID(item);\r\n            });\r\n        }\r\n\r\n        mediaInfo.isText = dashManifestModel.getIsTextTrack(mediaInfo.mimeType);\r\n        mediaInfo.supplementalProperties = dashManifestModel.getSupplementalPropperties(realAdaptation);\r\n\r\n        return mediaInfo;\r\n    }\r\n\r\n    function convertVideoInfoToEmbeddedTextInfo(mediaInfo, channel, lang) {\r\n        mediaInfo.id = channel; // CC1, CC2, CC3, or CC4\r\n        mediaInfo.index = 100 + parseInt(channel.substring(2, 3));\r\n        mediaInfo.type = constants.EMBEDDED_TEXT;\r\n        mediaInfo.codec = 'cea-608-in-SEI';\r\n        mediaInfo.isText = true;\r\n        mediaInfo.isEmbedded = true;\r\n        mediaInfo.lang = lang;\r\n        mediaInfo.roles = ['caption'];\r\n    }\r\n\r\n    function convertVideoInfoToThumbnailInfo(mediaInfo) {\r\n        mediaInfo.type = constants.IMAGE;\r\n    }\r\n\r\n    function convertPeriodToStreamInfo(period) {\r\n        let streamInfo = new StreamInfo();\r\n        const THRESHOLD = 1;\r\n\r\n        streamInfo.id = period.id;\r\n        streamInfo.index = period.index;\r\n        streamInfo.start = period.start;\r\n        streamInfo.duration = period.duration;\r\n        streamInfo.manifestInfo = convertMpdToManifestInfo(period.mpd);\r\n        streamInfo.isLast = period.mpd.manifest.Period_asArray.length === 1 || Math.abs((streamInfo.start + streamInfo.duration) - streamInfo.manifestInfo.duration) < THRESHOLD;\r\n\r\n        return streamInfo;\r\n    }\r\n\r\n    function convertMpdToManifestInfo(mpd) {\r\n        let manifestInfo = new ManifestInfo();\r\n\r\n        manifestInfo.DVRWindowSize = mpd.timeShiftBufferDepth;\r\n        manifestInfo.loadedTime = mpd.manifest.loadedTime;\r\n        manifestInfo.availableFrom = mpd.availabilityStartTime;\r\n        manifestInfo.minBufferTime = mpd.manifest.minBufferTime;\r\n        manifestInfo.maxFragmentDuration = mpd.maxSegmentDuration;\r\n        manifestInfo.duration = dashManifestModel.getDuration(mpd.manifest);\r\n        manifestInfo.isDynamic = dashManifestModel.getIsDynamic(mpd.manifest);\r\n        manifestInfo.serviceDescriptions = dashManifestModel.getServiceDescriptions(mpd.manifest);\r\n        manifestInfo.protocol = mpd.manifest.protocol;\r\n\r\n        return manifestInfo;\r\n    }\r\n\r\n    function checkConfig() {\r\n        if (!constants) {\r\n            throw new Error('setConfig function has to be called previously');\r\n        }\r\n    }\r\n\r\n    function getPeriod(periodIdx) {\r\n        return voPeriods.length > 0 ? voPeriods[0].mpd.manifest.Period_asArray[periodIdx] : null;\r\n    }\r\n\r\n    function findRepresentationIndex(period, representationId) {\r\n        const index = findRepresentation(period, representationId, true);\r\n\r\n        return index !== null ? index : -1;\r\n    }\r\n\r\n    function findRepresentation(period, representationId, returnIndex) {\r\n        let adaptationSet,\r\n            adaptationSetArray,\r\n            representation,\r\n            representationArray,\r\n            adaptationSetArrayIndex,\r\n            representationArrayIndex;\r\n\r\n        if (period) {\r\n            adaptationSetArray = period.AdaptationSet_asArray;\r\n            for (adaptationSetArrayIndex = 0; adaptationSetArrayIndex < adaptationSetArray.length; adaptationSetArrayIndex = adaptationSetArrayIndex + 1) {\r\n                adaptationSet = adaptationSetArray[adaptationSetArrayIndex];\r\n                representationArray = adaptationSet.Representation_asArray;\r\n                for (representationArrayIndex = 0; representationArrayIndex < representationArray.length; representationArrayIndex = representationArrayIndex + 1) {\r\n                    representation = representationArray[representationArrayIndex];\r\n                    if (representationId === representation.id) {\r\n                        if (returnIndex) {\r\n                            return representationArrayIndex;\r\n                        } else {\r\n                            return representation;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function findMaxBufferIndex(period, bufferType) {\r\n        let adaptationSet,\r\n            adaptationSetArray,\r\n            representationArray,\r\n            adaptationSetArrayIndex;\r\n\r\n        if (!period || !bufferType) return -1;\r\n\r\n        adaptationSetArray = period.AdaptationSet_asArray;\r\n        for (adaptationSetArrayIndex = 0; adaptationSetArrayIndex < adaptationSetArray.length; adaptationSetArrayIndex = adaptationSetArrayIndex + 1) {\r\n            adaptationSet = adaptationSetArray[adaptationSetArrayIndex];\r\n            representationArray = adaptationSet.Representation_asArray;\r\n            if (dashManifestModel.getIsTypeOf(adaptationSet, bufferType)) {\r\n                return representationArray.length;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    // #endregion PRIVATE FUNCTIONS\r\n\r\n    instance = {\r\n        getBandwidthForRepresentation: getBandwidthForRepresentation,\r\n        getIndexForRepresentation: getIndexForRepresentation,\r\n        getMaxIndexForBufferType: getMaxIndexForBufferType,\r\n        convertDataToRepresentationInfo: convertRepresentationToRepresentationInfo,\r\n        getDataForMedia: getAdaptationForMediaInfo,\r\n        getStreamsInfo: getStreamsInfo,\r\n        getMediaInfoForType: getMediaInfoForType,\r\n        getAllMediaInfoForType: getAllMediaInfoForType,\r\n        getAdaptationForType: getAdaptationForType,\r\n        getRealAdaptation: getRealAdaptation,\r\n        getRealPeriodByIndex,\r\n        getEssentialPropertiesForRepresentation,\r\n        getVoRepresentations: getVoRepresentations,\r\n        getEventsFor: getEventsFor,\r\n        getEvent: getEvent,\r\n        getMpd,\r\n        setConfig: setConfig,\r\n        updatePeriods: updatePeriods,\r\n        getIsTextTrack: getIsTextTrack,\r\n        getUTCTimingSources: getUTCTimingSources,\r\n        getSuggestedPresentationDelay: getSuggestedPresentationDelay,\r\n        getAvailabilityStartTime: getAvailabilityStartTime,\r\n        getIsTypeOf,\r\n        getIsDynamic: getIsDynamic,\r\n        getDuration: getDuration,\r\n        getRegularPeriods: getRegularPeriods,\r\n        getLocation: getLocation,\r\n        getPatchLocation: getPatchLocation,\r\n        getManifestUpdatePeriod: getManifestUpdatePeriod,\r\n        getPublishTime,\r\n        getIsDVB: getIsDVB,\r\n        getIsPatch: getIsPatch,\r\n        getBaseURLsFromElement: getBaseURLsFromElement,\r\n        getRepresentationSortFunction: getRepresentationSortFunction,\r\n        getCodec: getCodec,\r\n        getVoAdaptations: getVoAdaptations,\r\n        getVoPeriods: getVoPeriods,\r\n        getPeriodById,\r\n        setCurrentMediaInfo: setCurrentMediaInfo,\r\n        isPatchValid: isPatchValid,\r\n        applyPatchToManifest: applyPatchToManifest,\r\n        reset: reset\r\n    };\r\n\r\n    setup();\r\n    return instance;\r\n}\r\n\r\nDashAdapter.__dashjs_factory_name = 'DashAdapter';\r\nexport default FactoryMaker.getSingletonFactory(DashAdapter);\r\n"]}