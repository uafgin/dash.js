{"version":3,"sources":["../../../../src/streaming/MediaPlayerFactory.js"],"names":["MediaPlayerFactory","SUPPORTED_MIME_TYPE","logger","create","video","source","context","test","nodeName","_dashjs_player","player","videoID","id","name","slice","call","querySelectorAll","filter","s","type","src","document","createElement","initialize","autoplay","getDebug","getLogger","debug","createAll","selector","scope","aPlayers","videos","i","length","push","sources","findVideo","el","parentNode","instance","loadInterval","loadHandler","window","removeEventListener","loadIntervalHandler","dashjs","clearInterval","avoidAutoCreate","skipAutoCreate","addEventListener","readyState","setInterval"],"mappings":"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","file":"MediaPlayerFactory.js","sourcesContent":["import MediaPlayer from './MediaPlayer';\r\n\r\nfunction MediaPlayerFactory() {\r\n    /**\r\n     * mime-type identifier for any source content to be accepted as a dash manifest by the create() method.\r\n     * @type {string}\r\n     */\r\n    const SUPPORTED_MIME_TYPE = 'application/dash+xml';\r\n\r\n    let logger;\r\n\r\n    /**\r\n     *  A new MediaPlayer is instantiated for the supplied videoElement and optional source and context.  If no context is provided,\r\n     *  a default DashContext is used. If no source is provided, the videoElement is interrogated to extract the first source whose\r\n     *  type is application/dash+xml.\r\n     * The autoplay property of the videoElement is preserved. Any preload attribute is ignored. This method should be called after the page onLoad event is dispatched.\r\n     * @param {HTMLMediaElement} video\r\n     * @param {HTMLSourceElement} source\r\n     * @param {Object} context\r\n     * @returns {MediaPlayer|null}\r\n     */\r\n    function create(video, source, context) {\r\n        if (!video || !(/^VIDEO$/i).test(video.nodeName)) return null;\r\n\r\n        if (video._dashjs_player) return video._dashjs_player;\r\n\r\n        let player;\r\n        let videoID = (video.id || video.name || 'video element');\r\n\r\n        source = source || [].slice.call(video.querySelectorAll('source')).filter(function (s) {\r\n                return s.type == SUPPORTED_MIME_TYPE;\r\n            })[0];\r\n        if (!source && video.src) {\r\n            source = document.createElement('source');\r\n            source.src = video.src;\r\n        } else if (!source && !video.src) {\r\n            return null;\r\n        }\r\n\r\n        context = context || {};\r\n        player = MediaPlayer(context).create();\r\n        player.initialize(video, source.src, video.autoplay);\r\n\r\n        if (!logger) {\r\n            logger = player.getDebug().getLogger();\r\n        }\r\n        logger.debug('Converted ' + videoID + ' to dash.js player and added content: ' + source.src);\r\n\r\n        // Store a reference to the player on the video element so it can be gotten at for debugging and so we know its\r\n        // already been setup.\r\n        video._dashjs_player = player;\r\n\r\n        return player;\r\n    }\r\n\r\n    /**\r\n     * Searches the provided scope for all instances of the indicated selector. If no scope is provided, document is used. If no selector is\r\n     * specified, [data-dashjs-player] is used. The declarative setup also looks for source elements with the type attribute set to 'application/dash+xml'.\r\n     * It then looks for those video elements which have a source element defined with a type matching 'application/dash+xml'.\r\n     * A new MediaPlayer is instantiated for each matching video element and the appropriate source is assigned.\r\n     * The autoplay property of the video element is preserved. Any preload attribute is ignored. This method should be called after the page onLoad event is dispatched.\r\n     * Returns an array holding all the MediaPlayer instances that were added by this method.\r\n     * @param {string} selector - CSS selector\r\n     * @param {Object} scope\r\n     * @returns {Array} an array of MediaPlayer objects\r\n     */\r\n    function createAll(selector, scope) {\r\n        let aPlayers = [];\r\n        selector = selector || '[data-dashjs-player]';\r\n        scope = scope || document;\r\n        let videos = scope.querySelectorAll(selector);\r\n        for (let i = 0; i < videos.length; i++) {\r\n            let player = create(videos[i], null);\r\n            aPlayers.push(player);\r\n        }\r\n\r\n        let sources = scope.querySelectorAll('source[type=\"' + SUPPORTED_MIME_TYPE + '\"]');\r\n        for (let i = 0; i < sources.length; i++) {\r\n            let video = findVideo(sources[i]);\r\n            let player = create(video, null);\r\n            aPlayers.push(player);\r\n        }\r\n\r\n        return aPlayers;\r\n    }\r\n\r\n    function findVideo(el) {\r\n        if ((/^VIDEO$/i).test(el.nodeName)) {\r\n            return el;\r\n        } else {\r\n            return findVideo(el.parentNode);\r\n        }\r\n    }\r\n\r\n    return {\r\n        create: create,\r\n        createAll: createAll\r\n    };\r\n}\r\n\r\nlet instance = MediaPlayerFactory();\r\nlet loadInterval;\r\n\r\nfunction loadHandler() {\r\n    window.removeEventListener('load', loadHandler);\r\n    instance.createAll();\r\n}\r\n\r\nfunction loadIntervalHandler() {\r\n    if (window.dashjs) {\r\n        window.clearInterval(loadInterval);\r\n        instance.createAll();\r\n    }\r\n}\r\n\r\nlet avoidAutoCreate = typeof window !== 'undefined' && window && window.dashjs && window.dashjs.skipAutoCreate;\r\n\r\nif (!avoidAutoCreate && typeof window !== 'undefined' && window && window.addEventListener) {\r\n    if (window.document.readyState === 'complete') {\r\n        if (window.dashjs) {\r\n            instance.createAll();\r\n        } else {\r\n            // If loaded asynchronously, window.readyState may be 'complete' even if dashjs hasn't loaded yet\r\n            loadInterval = window.setInterval(loadIntervalHandler, 500);\r\n        }\r\n    } else {\r\n        window.addEventListener('load', loadHandler);\r\n    }\r\n}\r\n\r\nexport default instance;\r\n"]}