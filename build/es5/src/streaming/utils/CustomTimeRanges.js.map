{"version":3,"sources":["../../../../../src/streaming/utils/CustomTimeRanges.js"],"names":["CustomTimeRanges","customTimeRangeArray","length","add","start","end","i","splice","mergeRanges","clear","remove","rangeIndex1","rangeIndex2","range1","range2","index","NaN","__dashjs_factory_name","FactoryMaker","getClassFactory"],"mappings":"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","file":"CustomTimeRanges.js","sourcesContent":["/**\r\n* The copyright in this software is being made available under the BSD License,\r\n* included below. This software may be subject to other third party and contributor\r\n* rights, including patent rights, and no such rights are granted under this license.\r\n*\r\n* Copyright (c) 2013, Dash Industry Forum.\r\n* All rights reserved.\r\n*\r\n* Redistribution and use in source and binary forms, with or without modification,\r\n* are permitted provided that the following conditions are met:\r\n*  * Redistributions of source code must retain the above copyright notice, this\r\n*  list of conditions and the following disclaimer.\r\n*  * Redistributions in binary form must reproduce the above copyright notice,\r\n*  this list of conditions and the following disclaimer in the documentation and/or\r\n*  other materials provided with the distribution.\r\n*  * Neither the name of Dash Industry Forum nor the names of its\r\n*  contributors may be used to endorse or promote products derived from this software\r\n*  without specific prior written permission.\r\n*\r\n*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n*  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n*  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n*  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n*  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n*  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n*  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n*  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n*  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n*  POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\nimport FactoryMaker from '../../core/FactoryMaker';\r\nimport { checkInteger } from '../utils/SupervisorTools';\r\n\r\nfunction CustomTimeRanges(/*config*/) {\r\n    let customTimeRangeArray = [];\r\n    let length = 0;\r\n\r\n    function add(start, end) {\r\n        let i = 0;\r\n\r\n        for (i = 0; (i < this.customTimeRangeArray.length) && (start > this.customTimeRangeArray[i].start); i++);\r\n\r\n        this.customTimeRangeArray.splice(i, 0, {start: start,end: end});\r\n\r\n        for (i = 0; i < this.customTimeRangeArray.length - 1; i++) {\r\n            if (this.mergeRanges(i,i + 1)) {\r\n                i--;\r\n            }\r\n        }\r\n        this.length = this.customTimeRangeArray.length;\r\n    }\r\n\r\n    function clear() {\r\n        this.customTimeRangeArray = [];\r\n        this.length = 0;\r\n    }\r\n\r\n    function remove(start, end) {\r\n        for (let i = 0; i < this.customTimeRangeArray.length; i++) {\r\n            if (start <= this.customTimeRangeArray[i].start && end >= this.customTimeRangeArray[i].end) {\r\n                //      |--------------Range i-------|\r\n                //|---------------Range to remove ---------------|\r\n                //    or\r\n                //|--------------Range i-------|\r\n                //|--------------Range to remove ---------------|\r\n                //    or\r\n                //                 |--------------Range i-------|\r\n                //|--------------Range to remove ---------------|\r\n                this.customTimeRangeArray.splice(i,1);\r\n                i--;\r\n\r\n            } else if (start > this.customTimeRangeArray[i].start && end < this.customTimeRangeArray[i].end) {\r\n                //|-----------------Range i----------------|\r\n                //        |-------Range to remove -----|\r\n                this.customTimeRangeArray.splice(i + 1, 0, {start: end,end: this.customTimeRangeArray[i].end});\r\n                this.customTimeRangeArray[i].end = start;\r\n                break;\r\n            } else if ( start > this.customTimeRangeArray[i].start && start < this.customTimeRangeArray[i].end) {\r\n                //|-----------Range i----------|\r\n                //                    |---------Range to remove --------|\r\n                //    or\r\n                //|-----------------Range i----------------|\r\n                //            |-------Range to remove -----|\r\n                this.customTimeRangeArray[i].end = start;\r\n            } else if ( end > this.customTimeRangeArray[i].start && end < this.customTimeRangeArray[i].end) {\r\n                //                     |-----------Range i----------|\r\n                //|---------Range to remove --------|\r\n                //            or\r\n                //|-----------------Range i----------------|\r\n                //|-------Range to remove -----|\r\n                this.customTimeRangeArray[i].start = end;\r\n            }\r\n        }\r\n\r\n        this.length = this.customTimeRangeArray.length;\r\n    }\r\n\r\n    function mergeRanges(rangeIndex1, rangeIndex2) {\r\n        let range1 = this.customTimeRangeArray[rangeIndex1];\r\n        let range2 = this.customTimeRangeArray[rangeIndex2];\r\n\r\n        if (range1.start <=  range2.start && range2.start <= range1.end && range1.end <= range2.end) {\r\n            //|-----------Range1----------|\r\n            //                    |-----------Range2----------|\r\n            range1.end = range2.end;\r\n            this.customTimeRangeArray.splice(rangeIndex2,1);\r\n            return true;\r\n\r\n        } else if (range2.start <= range1.start && range1.start <= range2.end && range2.end <= range1.end) {\r\n            //                |-----------Range1----------|\r\n            //|-----------Range2----------|\r\n            range1.start = range2.start;\r\n            this.customTimeRangeArray.splice(rangeIndex2,1);\r\n            return true;\r\n        } else if (range2.start <= range1.start && range1.start <= range2.end && range1.end <= range2.end) {\r\n            //      |--------Range1-------|\r\n            //|---------------Range2--------------|\r\n            this.customTimeRangeArray.splice(rangeIndex1,1);\r\n            return true;\r\n        } else if (range1.start <= range2.start && range2.start <= range1.end && range2.end <= range1.end) {\r\n            //|-----------------Range1--------------|\r\n            //        |-----------Range2----------|\r\n            this.customTimeRangeArray.splice(rangeIndex2,1);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function start(index) {\r\n        checkInteger(index);\r\n\r\n        if (index >= this.customTimeRangeArray.length || index < 0) {\r\n            return NaN;\r\n        }\r\n\r\n        return this.customTimeRangeArray[index].start;\r\n    }\r\n\r\n    function end(index) {\r\n        checkInteger(index);\r\n\r\n        if (index >= this.customTimeRangeArray.length || index < 0) {\r\n            return NaN;\r\n        }\r\n\r\n        return this.customTimeRangeArray[index].end;\r\n    }\r\n\r\n    return {\r\n        customTimeRangeArray: customTimeRangeArray,\r\n        length: length,\r\n        add: add,\r\n        clear: clear,\r\n        remove: remove,\r\n        mergeRanges: mergeRanges,\r\n        start: start,\r\n        end: end\r\n    };\r\n}\r\nCustomTimeRanges.__dashjs_factory_name = 'CustomTimeRanges';\r\nexport default FactoryMaker.getClassFactory(CustomTimeRanges);\r\n"]}