{"version":3,"sources":["../../../../../src/streaming/vo/IsoBox.js"],"names":["IsoBox","boxData","offset","_offset","type","size","boxes","i","length","push","isComplete","timescale","earliest_presentation_time","first_offset","references","reference","reference_type","referenced_size","subsegment_duration","id","version","value","scheme_id_uri","presentation_time_delta","presentation_time","event_duration","message_data","sequence_number","entry_count","entries","base_data_offset","sample_description_index","default_sample_duration","default_sample_size","default_sample_flags","flags","baseMediaDecodeTime","sample_count","first_sample_flags","data_offset","samples","ln","sample","sample_size","sample_duration","sample_composition_time_offset"],"mappings":"qtBAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA8BA;;;MAIMA,O,YACF,gBAAYC,OAAZ,CAAqB,8BACjB,KAAKC,MAAL,CAAcD,QAAQE,OAAtB,CACA,KAAKC,IAAL,CAAYH,QAAQG,IAApB,CACA,KAAKC,IAAL,CAAYJ,QAAQI,IAApB,CACA,KAAKC,KAAL,CAAa,EAAb,CACA,GAAIL,QAAQK,KAAZ,CAAmB,CACf,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAIN,QAAQK,KAAR,CAAcE,MAAlC,CAA0CD,GAA1C,CAA+C,CAC3C,KAAKD,KAAL,CAAWG,IAAX,CAAgB,GAAIT,OAAJ,CAAWC,QAAQK,KAAR,CAAcC,CAAd,CAAX,CAAhB,EACH,CACJ,CACD,KAAKG,UAAL,CAAkB,IAAlB,CAEA,OAAQT,QAAQG,IAAhB,EACI,IAAK,MAAL,CACI,KAAKO,SAAL,CAAiBV,QAAQU,SAAzB,CACA,KAAKC,0BAAL,CAAkCX,QAAQW,0BAA1C,CACA,KAAKC,YAAL,CAAoBZ,QAAQY,YAA5B,CACA,KAAKC,UAAL,CAAkBb,QAAQa,UAA1B,CACA,GAAIb,QAAQa,UAAZ,CAAwB,CACpB,KAAKA,UAAL,CAAkB,EAAlB,CACA,IAAK,GAAIP,IAAI,CAAb,CAAgBA,GAAIN,QAAQa,UAAR,CAAmBN,MAAvC,CAA+CD,IAA/C,CAAoD,CAChD,GAAIQ,WAAY,CACZC,eAAgBf,QAAQa,UAAR,CAAmBP,EAAnB,EAAsBS,cAD1B,CAEZC,gBAAiBhB,QAAQa,UAAR,CAAmBP,EAAnB,EAAsBU,eAF3B,CAGZC,oBAAqBjB,QAAQa,UAAR,CAAmBP,EAAnB,EAAsBW,mBAH/B,CAAhB,CAKA,KAAKJ,UAAL,CAAgBL,IAAhB,CAAqBM,SAArB,EACH,CACJ,CACD,MACJ,IAAK,MAAL,CACI,KAAKI,EAAL,CAAUlB,QAAQkB,EAAlB,CACA,KAAKC,OAAL,CAAenB,QAAQmB,OAAR,GAAoB,CAApB,CAAwB,CAAxB,CAA4B,CAA3C,CACA,KAAKC,KAAL,CAAapB,QAAQoB,KAArB,CACA,KAAKV,SAAL,CAAiBV,QAAQU,SAAzB,CACA,KAAKW,aAAL,CAAqBrB,QAAQqB,aAA7B,CACA,KAAKC,uBAAL,CAA+BtB,QAAQmB,OAAR,GAAoB,CAApB,CAAwBnB,QAAQuB,iBAAhC,CAAoDvB,QAAQsB,uBAA3F,CACA,KAAKE,cAAL,CAAsBxB,QAAQwB,cAA9B,CACA,KAAKC,YAAL,CAAoBzB,QAAQyB,YAA5B,CACA,MACJ,IAAK,MAAL,CACI,KAAKf,SAAL,CAAiBV,QAAQU,SAAzB,CACA,MACJ,IAAK,MAAL,CACI,KAAKgB,eAAL,CAAuB1B,QAAQ0B,eAA/B,CACA,MACJ,IAAK,MAAL,CACI,KAAKC,WAAL,CAAmB3B,QAAQ2B,WAA3B,CACA,KAAKC,OAAL,CAAe5B,QAAQ4B,OAAvB,CACA,MACJ,IAAK,MAAL,CACI,KAAKC,gBAAL,CAAwB7B,QAAQ6B,gBAAhC,CACA,KAAKC,wBAAL,CAAgC9B,QAAQ8B,wBAAxC,CACA,KAAKC,uBAAL,CAA+B/B,QAAQ+B,uBAAvC,CACA,KAAKC,mBAAL,CAA2BhC,QAAQgC,mBAAnC,CACA,KAAKC,oBAAL,CAA4BjC,QAAQiC,oBAApC,CACA,KAAKC,KAAL,CAAalC,QAAQkC,KAArB,CACA,MACJ,IAAK,MAAL,CACI,KAAKf,OAAL,CAAenB,QAAQmB,OAAvB,CACA,KAAKgB,mBAAL,CAA2BnC,QAAQmC,mBAAnC,CACA,KAAKD,KAAL,CAAalC,QAAQkC,KAArB,CACA,MACJ,IAAK,MAAL,CACI,KAAKE,YAAL,CAAoBpC,QAAQoC,YAA5B,CACA,KAAKC,kBAAL,CAA0BrC,QAAQqC,kBAAlC,CACA,KAAKC,WAAL,CAAmBtC,QAAQsC,WAA3B,CACA,KAAKJ,KAAL,CAAalC,QAAQkC,KAArB,CACA,KAAKK,OAAL,CAAevC,QAAQuC,OAAvB,CACA,GAAIvC,QAAQuC,OAAZ,CAAqB,CACjB,KAAKA,OAAL,CAAe,EAAf,CACA,IAAK,GAAIjC,KAAI,CAAR,CAAWkC,GAAKxC,QAAQuC,OAAR,CAAgBhC,MAArC,CAA6CD,IAAIkC,EAAjD,CAAqDlC,KAArD,CAA0D,CACtD,GAAImC,QAAS,CACTC,YAAa1C,QAAQuC,OAAR,CAAgBjC,GAAhB,EAAmBoC,WADvB,CAETC,gBAAiB3C,QAAQuC,OAAR,CAAgBjC,GAAhB,EAAmBqC,eAF3B,CAGTC,+BAAgC5C,QAAQuC,OAAR,CAAgBjC,GAAhB,EAAmBsC,8BAH1C,CAAb,CAKA,KAAKL,OAAL,CAAa/B,IAAb,CAAkBiC,MAAlB,EACH,CACJ,CACD,MApER,CAuEH,C,mEAEWtC,I,CAAM,CACd,IAAK,GAAIG,GAAI,CAAb,CAAgBA,EAAI,KAAKD,KAAL,CAAWE,MAA/B,CAAuCD,GAAvC,CAA4C,CACxC,GAAI,KAAKD,KAAL,CAAWC,CAAX,EAAcH,IAAd,GAAuBA,IAA3B,CAAiC,CAC7B,MAAO,MAAKE,KAAL,CAAWC,CAAX,CAAP,CACH,CACJ,CACJ,C,oDAEaH,I,CAAM,CAChB,GAAIE,OAAQ,EAAZ,CACA,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAI,KAAKD,KAAL,CAAWE,MAA/B,CAAuCD,GAAvC,CAA4C,CACxC,GAAI,KAAKD,KAAL,CAAWC,CAAX,EAAcH,IAAd,GAAuBA,IAA3B,CAAiC,CAC7BE,MAAMG,IAAN,CAAW,KAAKH,KAAL,CAAWC,CAAX,CAAX,EACH,CACJ,CACD,MAAOD,MAAP,CACH,C,sCAIUN,M","file":"IsoBox.js","sourcesContent":["/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @class\r\n * @ignore\r\n */\r\nclass IsoBox {\r\n    constructor(boxData) {\r\n        this.offset = boxData._offset;\r\n        this.type = boxData.type;\r\n        this.size = boxData.size;\r\n        this.boxes = [];\r\n        if (boxData.boxes) {\r\n            for (let i = 0; i < boxData.boxes.length; i++) {\r\n                this.boxes.push(new IsoBox(boxData.boxes[i]));\r\n            }\r\n        }\r\n        this.isComplete = true;\r\n\r\n        switch (boxData.type) {\r\n            case 'sidx':\r\n                this.timescale = boxData.timescale;\r\n                this.earliest_presentation_time = boxData.earliest_presentation_time;\r\n                this.first_offset = boxData.first_offset;\r\n                this.references = boxData.references;\r\n                if (boxData.references) {\r\n                    this.references = [];\r\n                    for (let i = 0; i < boxData.references.length; i++) {\r\n                        let reference = {\r\n                            reference_type: boxData.references[i].reference_type,\r\n                            referenced_size: boxData.references[i].referenced_size,\r\n                            subsegment_duration: boxData.references[i].subsegment_duration\r\n                        };\r\n                        this.references.push(reference);\r\n                    }\r\n                }\r\n                break;\r\n            case 'emsg':\r\n                this.id = boxData.id;\r\n                this.version = boxData.version === 1 ? 1 : 0;\r\n                this.value = boxData.value;\r\n                this.timescale = boxData.timescale;\r\n                this.scheme_id_uri = boxData.scheme_id_uri;\r\n                this.presentation_time_delta = boxData.version === 1 ? boxData.presentation_time : boxData.presentation_time_delta;\r\n                this.event_duration = boxData.event_duration;\r\n                this.message_data = boxData.message_data;\r\n                break;\r\n            case 'mdhd':\r\n                this.timescale = boxData.timescale;\r\n                break;\r\n            case 'mfhd':\r\n                this.sequence_number = boxData.sequence_number;\r\n                break;\r\n            case 'subs':\r\n                this.entry_count = boxData.entry_count;\r\n                this.entries = boxData.entries;\r\n                break;\r\n            case 'tfhd':\r\n                this.base_data_offset = boxData.base_data_offset;\r\n                this.sample_description_index = boxData.sample_description_index;\r\n                this.default_sample_duration = boxData.default_sample_duration;\r\n                this.default_sample_size = boxData.default_sample_size;\r\n                this.default_sample_flags = boxData.default_sample_flags;\r\n                this.flags = boxData.flags;\r\n                break;\r\n            case 'tfdt':\r\n                this.version = boxData.version;\r\n                this.baseMediaDecodeTime = boxData.baseMediaDecodeTime;\r\n                this.flags = boxData.flags;\r\n                break;\r\n            case 'trun':\r\n                this.sample_count = boxData.sample_count;\r\n                this.first_sample_flags = boxData.first_sample_flags;\r\n                this.data_offset = boxData.data_offset;\r\n                this.flags = boxData.flags;\r\n                this.samples = boxData.samples;\r\n                if (boxData.samples) {\r\n                    this.samples = [];\r\n                    for (let i = 0, ln = boxData.samples.length; i < ln; i++) {\r\n                        let sample = {\r\n                            sample_size: boxData.samples[i].sample_size,\r\n                            sample_duration: boxData.samples[i].sample_duration,\r\n                            sample_composition_time_offset: boxData.samples[i].sample_composition_time_offset\r\n                        };\r\n                        this.samples.push(sample);\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    getChildBox(type) {\r\n        for (let i = 0; i < this.boxes.length; i++) {\r\n            if (this.boxes[i].type === type) {\r\n                return this.boxes[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    getChildBoxes(type) {\r\n        let boxes = [];\r\n        for (let i = 0; i < this.boxes.length; i++) {\r\n            if (this.boxes[i].type === type) {\r\n                boxes.push(this.boxes[i]);\r\n            }\r\n        }\r\n        return boxes;\r\n    }\r\n\r\n}\r\n\r\nexport default IsoBox;\r\n"]}