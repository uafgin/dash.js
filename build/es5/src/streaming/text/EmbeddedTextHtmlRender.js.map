{"version":3,"sources":["../../../../../src/streaming/text/EmbeddedTextHtmlRender.js"],"names":["EmbeddedTextHtmlRender","captionId","instance","checkIndent","chars","line","c","length","uc","uchar","l","ll","replace","getRegionProperties","region","x","y1","Math","max","y2","createRGB","color","getStyle","videoElement","style","fontSize","videoHeight","foreground","italics","underline","background","ltrim","s","rtrim","createHTMLCaptionsFromScreen","startTime","endTime","captionScreen","currRegion","existingRegion","lastRowHasText","lastRowIndentL","currP","start","end","spans","currentStyle","seenRegions","styleStates","regions","r","row","rows","prevPenState","isEmpty","rowIndent","p","push","name","hasOwnProperty","contat","currPenState","penState","equals","trim","currPenStateString","JSON","parse","stringify","captionsArray","cueID","finalDiv","document","createElement","id","cueRegionProperties","cssText","bodyDiv","className","cueUniWrapper","ptag","lastSpanRow","span","brElement","appendChild","sameRow","spanStyle","spanElement","textContent","type","cueHTMLElement","cellResolution","isFromCEA608","lineHeight","linePadding","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"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","file":"EmbeddedTextHtmlRender.js","sourcesContent":["/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\nimport FactoryMaker from '../../core/FactoryMaker';\r\n\r\nfunction EmbeddedTextHtmlRender() {\r\n\r\n    let captionId = 0;\r\n    let instance;\r\n\r\n    /* HTML Rendering functions */\r\n    function checkIndent(chars) {\r\n        let line = '';\r\n\r\n        for (let c = 0; c < chars.length; ++c) {\r\n            const uc = chars[c];\r\n            line += uc.uchar;\r\n        }\r\n\r\n        const l = line.length;\r\n        const ll = line.replace(/^\\s+/,'').length;\r\n        return l - ll;\r\n    }\r\n\r\n    function getRegionProperties(region) {\r\n        return 'left: ' + (region.x * 3.125) + '%; top: ' + (region.y1 * 6.66) + '%; width: ' + (100 - (region.x * 3.125)) + '%; height: ' + (Math.max((region.y2 - 1) - region.y1, 1) * 6.66) + '%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;';\r\n    }\r\n\r\n    function createRGB(color) {\r\n        if (color === 'red') {\r\n            return 'rgb(255, 0, 0)';\r\n        } else if (color === 'green') {\r\n            return 'rgb(0, 255, 0)';\r\n        } else if (color === 'blue') {\r\n            return 'rgb(0, 0, 255)';\r\n        } else if (color === 'cyan') {\r\n            return 'rgb(0, 255, 255)';\r\n        } else if (color === 'magenta') {\r\n            return 'rgb(255, 0, 255)';\r\n        } else if (color === 'yellow') {\r\n            return 'rgb(255, 255, 0)';\r\n        } else if (color === 'white') {\r\n            return 'rgb(255, 255, 255)';\r\n        } else if (color === 'black') {\r\n            return 'rgb(0, 0, 0)';\r\n        }\r\n        return color;\r\n    }\r\n\r\n    function getStyle(videoElement, style) {\r\n        const fontSize = videoElement.videoHeight / 15.0;\r\n        if (style) {\r\n            return 'font-size: ' + fontSize + 'px; font-family: Menlo, Consolas, \\'Cutive Mono\\', monospace; color: ' + ((style.foreground) ? createRGB(style.foreground) : 'rgb(255, 255, 255)') + '; font-style: ' + (style.italics ? 'italic' : 'normal') + '; text-decoration: ' + (style.underline ? 'underline' : 'none') + '; white-space: pre; background-color: ' + ((style.background) ? createRGB(style.background) : 'transparent') + ';';\r\n        } else {\r\n            return 'font-size: ' + fontSize + 'px; font-family: Menlo, Consolas, \\'Cutive Mono\\', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;';\r\n        }\r\n    }\r\n\r\n    function ltrim(s) {\r\n        return s.replace(/^\\s+/g, '');\r\n    }\r\n\r\n    function rtrim(s) {\r\n        return s.replace(/\\s+$/g, '');\r\n    }\r\n\r\n    function createHTMLCaptionsFromScreen(videoElement, startTime, endTime, captionScreen) {\r\n        let currRegion = null;\r\n        let existingRegion = null;\r\n        let lastRowHasText = false;\r\n        let lastRowIndentL = -1;\r\n        let currP = {start: startTime, end: endTime, spans: []};\r\n        let currentStyle = 'style_cea608_white_black';\r\n        const seenRegions = {};\r\n        const styleStates = {};\r\n        const regions = [];\r\n        let r, s;\r\n\r\n        for (r = 0; r < 15; ++r) {\r\n            const row = captionScreen.rows[r];\r\n            let line = '';\r\n            let prevPenState = null;\r\n\r\n            if (false === row.isEmpty()) {\r\n                /* Row is not empty */\r\n\r\n                /* Get indentation of this row */\r\n                const rowIndent = checkIndent(row.chars);\r\n\r\n                /* Create a new region is there is none */\r\n                if (currRegion === null) {\r\n                    currRegion = { x: rowIndent, y1: r, y2: (r + 1), p: [] };\r\n                }\r\n\r\n                /* Check if indentation has changed and we had text of last row */\r\n                if ((rowIndent !== lastRowIndentL) && lastRowHasText) {\r\n                    currRegion.p.push(currP);\r\n                    currP = { start: startTime, end: endTime, spans: [] };\r\n                    currRegion.y2 = r;\r\n                    currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\r\n                    if (false === seenRegions.hasOwnProperty(currRegion.name)) {\r\n                        regions.push(currRegion);\r\n                        seenRegions[currRegion.name] = currRegion;\r\n                    } else {\r\n                        existingRegion = seenRegions[currRegion.name];\r\n                        existingRegion.p.contat(currRegion.p);\r\n                    }\r\n\r\n                    currRegion = { x: rowIndent, y1: r, y2: (r + 1), p: [] };\r\n                }\r\n\r\n                for (let c = 0; c < row.chars.length; ++c) {\r\n                    const uc = row.chars[c];\r\n                    const currPenState = uc.penState;\r\n                    if ((prevPenState === null) || (!currPenState.equals(prevPenState))) {\r\n                        if (line.trim().length > 0) {\r\n                            currP.spans.push({ name: currentStyle, line: line, row: r });\r\n                            line = '';\r\n                        }\r\n\r\n                        let currPenStateString = 'style_cea608_' + currPenState.foreground + '_' + currPenState.background;\r\n                        if (currPenState.underline) {\r\n                            currPenStateString += '_underline';\r\n                        }\r\n                        if (currPenState.italics) {\r\n                            currPenStateString += '_italics';\r\n                        }\r\n\r\n                        if (!styleStates.hasOwnProperty(currPenStateString)) {\r\n                            styleStates[currPenStateString] = JSON.parse(JSON.stringify(currPenState));\r\n                        }\r\n\r\n                        prevPenState = currPenState;\r\n\r\n                        currentStyle = currPenStateString;\r\n                    }\r\n\r\n                    line += uc.uchar;\r\n                }\r\n\r\n                if (line.trim().length > 0) {\r\n                    currP.spans.push({ name: currentStyle, line: line, row: r });\r\n                }\r\n\r\n                lastRowHasText = true;\r\n                lastRowIndentL = rowIndent;\r\n            } else {\r\n                /* Row is empty */\r\n                lastRowHasText = false;\r\n                lastRowIndentL = -1;\r\n\r\n                if (currRegion) {\r\n                    currRegion.p.push(currP);\r\n                    currP = { start: startTime, end: endTime, spans: [] };\r\n                    currRegion.y2 = r;\r\n                    currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\r\n                    if (false === seenRegions.hasOwnProperty(currRegion.name)) {\r\n                        regions.push(currRegion);\r\n                        seenRegions[currRegion.name] = currRegion;\r\n                    } else {\r\n                        existingRegion = seenRegions[currRegion.name];\r\n                        existingRegion.p.contat(currRegion.p);\r\n                    }\r\n\r\n                    currRegion = null;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        if (currRegion) {\r\n            currRegion.p.push(currP);\r\n            currRegion.y2 = r + 1;\r\n            currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\r\n            if (false === seenRegions.hasOwnProperty(currRegion.name)) {\r\n                regions.push(currRegion);\r\n                seenRegions[currRegion.name] = currRegion;\r\n            } else {\r\n                existingRegion = seenRegions[currRegion.name];\r\n                existingRegion.p.contat(currRegion.p);\r\n            }\r\n\r\n            currRegion = null;\r\n        }\r\n\r\n        const captionsArray = [];\r\n\r\n        /* Loop thru regions */\r\n        for (r = 0; r < regions.length; ++r) {\r\n            const region = regions[r];\r\n\r\n            const cueID = 'sub_cea608_' + (captionId++);\r\n            const finalDiv = document.createElement('div');\r\n            finalDiv.id = cueID;\r\n            const cueRegionProperties = getRegionProperties(region);\r\n            finalDiv.style.cssText = 'position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;' + cueRegionProperties;\r\n\r\n            const bodyDiv = document.createElement('div');\r\n            bodyDiv.className = 'paragraph bodyStyle';\r\n            bodyDiv.style.cssText = getStyle(videoElement);\r\n\r\n            const cueUniWrapper = document.createElement('div');\r\n            cueUniWrapper.className = 'cueUniWrapper';\r\n            cueUniWrapper.style.cssText = 'unicode-bidi: normal; direction: ltr;';\r\n\r\n            for (let p = 0; p < region.p.length; ++p) {\r\n                const ptag = region.p[p];\r\n                let lastSpanRow = 0;\r\n                for (s = 0; s < ptag.spans.length; ++s) {\r\n                    let span = ptag.spans[s];\r\n                    if (span.line.length > 0) {\r\n                        if ((s !== 0) && lastSpanRow != span.row) {\r\n                            const brElement = document.createElement('br');\r\n                            brElement.className = 'lineBreak';\r\n                            cueUniWrapper.appendChild(brElement);\r\n                        }\r\n                        let sameRow = false;\r\n                        if (lastSpanRow === span.row) {\r\n                            sameRow = true;\r\n                        }\r\n                        lastSpanRow = span.row;\r\n                        const spanStyle = styleStates[span.name];\r\n                        const spanElement = document.createElement('span');\r\n                        spanElement.className = 'spanPadding ' + span.name + ' customSpanColor';\r\n                        spanElement.style.cssText = getStyle(videoElement, spanStyle);\r\n                        /* If this is not the first span, and it's on the same\r\n                         * row as the last one */\r\n                        if ((s !== 0) && sameRow) {\r\n                            /* and it's the last span on this row */\r\n                            if (s === ptag.spans.length - 1) {\r\n                                /* trim only the right side */\r\n                                spanElement.textContent = rtrim(span.line);\r\n                            } else {\r\n                                /* don't trim at all */\r\n                                spanElement.textContent = span.line;\r\n                            }\r\n                        } else {\r\n                            /* if there is more than 1 span and this isn't the last span */\r\n                            if (ptag.spans.length > 1 && s < (ptag.spans.length - 1)) {\r\n                                /* Check if next text is on same row */\r\n                                if (span.row === ptag.spans[s + 1].row) {\r\n                                    /* Next element on same row, trim start */\r\n                                    spanElement.textContent = ltrim(span.line);\r\n                                } else {\r\n                                    /* Different rows, trim both */\r\n                                    spanElement.textContent = span.line.trim();\r\n                                }\r\n                            } else {\r\n                                spanElement.textContent = span.line.trim();\r\n                            }\r\n                        }\r\n                        cueUniWrapper.appendChild(spanElement);\r\n                    }\r\n                }\r\n            }\r\n\r\n            bodyDiv.appendChild(cueUniWrapper);\r\n            finalDiv.appendChild(bodyDiv);\r\n\r\n            const fontSize = { 'bodyStyle': ['%', 90] };\r\n            for (const s in styleStates) {\r\n                if (styleStates.hasOwnProperty(s)) {\r\n                    fontSize[s] = ['%', 90];\r\n                }\r\n            }\r\n\r\n            captionsArray.push({ type: 'html',\r\n                                start: startTime,\r\n                                end: endTime,\r\n                                cueHTMLElement: finalDiv,\r\n                                cueID: cueID,\r\n                                cellResolution: [32, 15],\r\n                                isFromCEA608: true,\r\n                                fontSize: fontSize,\r\n                                lineHeight: {},\r\n                                linePadding: {}\r\n                               });\r\n        }\r\n        return captionsArray;\r\n    }\r\n\r\n    instance = {\r\n        createHTMLCaptionsFromScreen: createHTMLCaptionsFromScreen\r\n    };\r\n    return instance;\r\n}\r\n\r\nEmbeddedTextHtmlRender.__dashjs_factory_name = 'EmbeddedTextHtmlRender';\r\nexport default FactoryMaker.getSingletonFactory(EmbeddedTextHtmlRender);\r\n"]}